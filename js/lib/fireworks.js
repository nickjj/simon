function Animator(){var e=this;writeDebug("Animator()");this.tweens=[];this.tweens["default"]=[1,2,3,4,5,6,7,8,9,10,9,8,7,6,5,4,3,2,1];this.tweens.blast=[12,12,11,10,10,9,8,7,6,5,4,3,2,1];this.tweens.fade=[10,10,10,10,10,10,10,10,10,10];this.queue=[];this.queue.IDs=[];this.active=false;this.timer=null;this.createTween=function(t,n,r){r=r||"default";var i=[t];var s=t;var o=n-t;var u=e.tweens[r].length;for(var a=0;a<u;a++){s+=o*e.tweens[r][a]*.01;i[a]={};i[a].data=s;i[a].event=null}return i};this.enqueue=function(t,n,r){var i;if(!n){writeDebug("animator.enqueue(): missing fMethod")}if(typeof e.queue.IDs[t.oID]=="undefined"){i=e.queue.length;e.queue.IDs[t.oID]=i;e.queue[i]=t}else{i=e.queue.IDs[t.oID];e.queue[i].active=true;e.queue[i].frame=0}t.active=true;e.queue[i]._method=n;e.queue[i]._oncomplete=r?r:null};this.animate=function(){var t=0;for(var n=e.queue.length;n--;){if(e.queue[n].active){e.queue[n]._method();t++}}if(t===0&&e.timer){e.stop()}else{}};this.start=function(){if(e.timer||e.active){return false}e.active=true;e.timer=setInterval(e.animate,fc.intervalRate)};this.stop=function(){clearInterval(e.timer);e.timer=null;e.active=false;e.queue=[];e.queue.IDs=[]}}function FireworksController(){var e=this;this.intervalRate=20;this.DEBUG=true;this.oFW=null;this.isIE=!!navigator.userAgent.match(/msie/i);this.isOpera=!!navigator.userAgent.match(/opera/i);if(this.isOpera){this.isIE=false}this.fireworks=[];this.animator=null;this.gOID=0;this.particleTypes=6;this.particleXY=10;this.tweenFade=[100,90,80,70,60,50,40,30,20,10,0];this.isSafari=!!navigator.appVersion.match(/webkit/i);this.canvasX=null;this.canvasY=null;this.screenY=null;e.scrollY=null;e.getWindowCoords=function(){e.canvasX=document.documentElement.clientWidth||document.body.clientWidth||document.body.scrollWidth;e.canvasY=document.documentElement.clientHeight||document.body.clientHeight||document.body.scrollHeight;e.screenY=e.canvasY;e.scrollY=parseInt(window.scrollY||document.documentElement.scrollTop||document.body.scrollTop,10);e.canvasY+=e.scrollY};this.getWindowCoordsAlt=function(){e.canvasX=window.innerWidth-16;e.canvasY=window.innerHeight;e.screenY=e.canvasY;e.scrollY=parseInt(window.scrollY||document.documentElement.scrollTop||document.body.scrollTop,10);e.canvasY+=e.scrollY};this.getPanX=function(t){t=parseInt(t,10);var n=t/e.canvasX;if(n<.4){n*=-1}else if(n>=.4&&n<=.6){n=.5}n=parseInt(n*100,10);return n};this.isEmpty=function(e){return typeof e=="undefined"||e===null&&e!==0||e===""&&e!==0||e=="null"};this.init=function(){e.oFW=document.getElementById("fw");e.oFP=document.getElementById("fp");if(typeof enableDebugMode!="undefined"&&(e.DEBUG||window.location.toString().toLowerCase().indexOf("debug")>=0)){enableDebugMode()}e.getWindowCoords();e.animator=new Animator};this.destructor=function(){for(var t=e.fireworks.length;t--;){e.fireworks[t]=null}e.fireworks=null};if(this.isSafari||this.isOpera){this.getWindowCoords=this.getWindowCoordsAlt}}function Firework(e,t,n,r,i,s,o,u,a,f,l){var c=this;this.oID="fp"+fc.gOID++;var h="";for(var p=0;p<arguments.length-1;p++){h+=arguments[p]+","}h+=arguments[p];writeDebug("firework("+h+")");this.oC=e;this.o=fc.oFW.cloneNode(!fc.isIE?true:false);this.particles=[];this.vX=-1;this.vY=-4;this.x=t;this.y=n;this.allowRandom=f;this.obeyBoundaries=l;this.frame=0;this.tween=[];this.active=false;this.moveTo=function(e,t){c.o.style.left=e+"px";c.o.style.top=t+"px";c.x=e;c.y=t};this.slideTo=function(e,t){c.tween=[fc.animator.createTween(c.x,e,"blast"),fc.animator.createTween(c.y,t,"blast")];fc.animator.enqueue(c,c.animate,c.aniExplode)};this.aniExplode=function(){c.o.style.background="none";c.o.style.border="none";for(var e=c.particles.length;--e;){c.particles[e].o.style.display="block";fc.animator.enqueue(c.particles[e],c.particles[e].animate)}c.particles[e].o.style.display="block";fc.animator.enqueue(c.particles[e],c.particles[e].animate,c.beginFade)};this.beginFade=function(){c.tween=fc.animator.createTween(1,0,"fade");fc.animator.enqueue(c,c.aniFade,c.destructor)};this.aniFade=function(){for(var e=c.particles.length;e--;){c.particles[e].moveRel();c.particles[e].nextState();c.particles[e].setOpacity(fc.tweenFade[c.frame])}if(c.frame++>=c.tween.length){c.active=false;c.frame=0;if(c._oncomplete){c._oncomplete()}c._oncomplete=null;return false}return true};this.destructor=function(){writeDebug("firework.destructor()");for(var e=c.particles.length;e--;){c.particles[e].destructor();c.particles[e]=null}c.particles=null;c.oC.removeChild(c.o);c.o=null;c.oC=null};this.animate=function(){c.moveTo(c.tween[0][c.frame].data,c.tween[1][c.frame].data,"burst");if(c.frame++>=c.tween[0].length-1){c.active=false;c.frame=0;if(c._oncomplete){c._oncomplete()}c._oncomplete=null;return false}return true};this.createBurst=function(e,t,n,s){writeDebug("firework.createBurst("+e+","+t+","+n+","+s+")");var o=0,u=0;var a=0;var f=n/e;var l=f;var h=0;var p=0;var d=c.allowRandom?.33+Math.random():1;var v=[];var m=Math.random()>.5;var g=[s,e>1?parseInt(Math.random()*fc.particleTypes,10):s];var y=null;for(o=0;o<e;o++){v[o]=parseInt(t*(o+1)/e*1/e,10)||1;h=p;p=360/v[o];y=g[o%2];for(u=0;u<v[o];u++){c.particles[a]=new FireworkParticle(c.o,c.allowRandom,y,r,i,c.obeyBoundaries);c.particles[a].slideTo(l*Math.cos(h*Math.PI/180),l*d*Math.sin(h*Math.PI/180));h+=p;a++}l+=f}};c.oC.appendChild(c.o);c.moveTo(c.x,c.y);c.createBurst(a,u,o,s);c.slideTo(r,i);var d="fire"+parseInt(Math.random()*2,10);fc.animator.start()}function FireworkParticle(e,t,n,r,i,s){var o=this;this.oC=e;this.oID="fp"+fc.gOID++;this.o=fc.oFP.cloneNode(true);this.obeyBoundaries=s;this.type=null;this.oImg=this.o.getElementsByTagName("img")[0];this.oImg._src=this.oImg.src;this.o.style.display="none";this.baseX=r;this.baseY=i;this.x=0;this.y=0;this.vx=0;this.vy=0;this.frame=0;this.tween=[];this.active=null;this.tweenType="blast";this.states=[];this.state=parseInt(Math.random()*3,10);this.isRandom=t;this._mt=5;this.moveTo=function(e,t){o.o.style.left=e+"px";o.o.style.top=t+"px";o.vx=e-o.x;o.vy=t-o.y;o.x=e;o.y=t};this.moveRel=function(){var e=o.x+o.vx;var t=o.y+o.vy;if(o.obeyBoundaries){var n=fc.canvasX-o.baseX-fc.particleXY;var r=fc.canvasY-o.baseY-fc.particleXY;var i=fc.scrollY;if(o.vx>=0){if(e>=n){o.vx*=-1}}else if(o.vx<0&&e+o.baseX<=0){o.vx*=-1}if(o.vy>=0){if(t>=r){o.vy*=-1}}else if(o.vy<0){if(t+o.baseY-i<=0){o.vy*=-1}}}o.moveTo(o.x+o.vx,o.y+o.vy)};this.setOpacity=function(e){o.oImg.style.marginLeft=-100+e*fc.particleXY/10+"px"};this.nextState=function(){var e=o.o.style.visibility;if(o.state==2&&e!="hidden"){o.o.style.visibility="hidden"}else if(o.state!=2&&e=="hidden"){o.o.style.visibility="visible"}o.state=parseInt(Math.random()*3,10)};this.slideTo=function(e,t){if(o.isRandom){e+=e*.2*(Math.random()>.5?1:-1);t+=t*.2*(Math.random()>.5?1:-1)}o.tween=[fc.animator.createTween(o.x,e,o.tweenType),fc.animator.createTween(o.y,t,o.tweenType)];var n=fc.canvasX-fc.particleXY;var r=fc.canvasY-fc.particleXY;var i=fc.particleXY-o.baseX;var s=fc.scrollY;var u=null;var a=null;if(o.obeyBoundaries){for(var f=o.tween[0].length;f--;){u=o.tween[0][f].data+o.baseX;a=o.tween[1][f].data+o.baseY;if(u>=n){o.tween[0][f].data-=(u-n)*2}else if(u<0){o.tween[0][f].data-=u*2}if(a>=r){o.tween[1][f].data-=(a-r)*2}else if(a-s<=0){o.tween[1][f].data-=(a-s)*2}}}};this.animate=function(){var e=o.tween[0][o.frame].data;var t=o.tween[1][o.frame].data;o.moveTo(e,t);if(o.frame++>=o.tween[0].length-1){if(o._oncomplete){o._oncomplete()}o._oncomplete=null;o.active=false;o.frame=0;return false}else if(o.frame>10){o.nextState()}return true};this.destructor=function(){o.oImg=null;o.oC.removeChild(o.o);o.oC=null;o.o=null};this.setType=function(e){o.type=e;o.oImg.style.marginTop=-(fc.particleXY*e)+"px"};o.setType(n);o.oC.appendChild(o.o)}function createFirework(e,t,n,r,i,s,o,u,a,f){var l="";for(var c in arguments){if(arguments.hasOwnProperty(c)){l+=c+","}}writeDebug("createFirework("+l+")");if(fc.isEmpty(i)){i=parseInt(Math.random()*fc.canvasX,10)}else{i=parseInt(fc.canvasX*i/100,10)}if(fc.isEmpty(s)){s=fc.canvasY-fc.particleXY}else{s=fc.canvasY-fc.screenY+parseInt(fc.screenY*s/100,10)}if(fc.isEmpty(o)){o=parseInt(fc.canvasX*.1+Math.random()*fc.canvasX*.8,10)}else{o=parseInt(fc.canvasX*o/100,10)}if(fc.isEmpty(u)){u=fc.canvasY-parseInt(Math.random()*fc.screenY,10)}else{u=fc.canvasY-parseInt(fc.screenY*(100-u)/100,10)}if(fc.isEmpty(r)){r=parseInt(Math.random()*fc.particleTypes,10)}if(fc.isEmpty(e)){e=64+parseInt(Math.random()*fc.screenY*.75,10)}else if(e.toString().indexOf("%")>=0){e=parseInt(parseInt(e,10)/100*fc.screenY,10)}else if(e.toString().indexOf(".")>=0){e=parseInt(e*fc.screenY,10)}else{e=parseInt(e*fc.screenY/100,10)}if(fc.isEmpty(t)){t=4+parseInt(Math.random()*64,10)}if(fc.isEmpty(n)){n=Math.random()>.5?2:1}if(fc.isEmpty(a)){a=Math.random()>.5}if(fc.isEmpty(f)){f=Math.random()>.5}fc.getWindowCoords();fc.fireworks[fc.fireworks.length]=new Firework(document.getElementById("fireContainer"),i,s,o,u,r,e,t,n,a,f)}function addEventHandler(e,t,n){return typeof attachEvent=="undefined"?e.addEventListener(t,n,false):e.attachEvent("on"+t,n)}function removeEventHandler(e,t,n){return typeof attachEvent=="undefined"?e.removeEventListener(t,n,false):e.detachEvent("on"+t,n)}var fc;fc=new FireworksController;if(typeof writeDebug=="undefined"){window.writeDebug=function(){return false}}addEventHandler(window,"resize",fc.getWindowCoords);addEventHandler(window,"scroll",fc.getWindowCoords);addEventHandler(window,"load",fc.init);addEventHandler(window,"unload",fc.destructor)